{% extends "stregsystem/base.html" %}

{% load static %}

{% load stregsystem_extras %}

{% block title %}Treoens stregsystem : Brugerinfo {% endblock %}

{% block content %}

<main class="center">
   <h3>{{member.firstname}} {{member.lastname}} ({{member.email}})</h3>

   <h2><a href="/{{room.id}}/sale/{{member.id}}">Tilbage til produktmenu</a></h2>

   {% spaceless %}
   <h4>Du {% if negative_balance %}
   skylder <span style="color: red;">{{member.balance|money|cut:"-"}}</span> kroner
   {% else %}har {{member.balance|money}} kroner til gode!
   {% endif %}
   </h4>
   {% endspaceless %}

   {% if stregforbud %}
      <h1 style="color: red;"><blink>STREGFORBUD!</blink></h1>
   {% endif %}

   <p><b>Sidste indbetaling:</b> 
      {% if last_payment %}
         {{last_payment.amount|money}} kr. d. {{last_payment.timestamp}}
         {% else %}
         Ingen indbetalinger!
      {% endif %}
   </p>

   <br />

   <p><b>Sidste 10 k√∏b</b></p>
   <table class="default">
      <tr>
         <th>Dato og tidspunkt</th>
         <th>Produkt</th>
         <th>Pris</th>
      </tr>
      {% autoescape off %}
      {% for sale in last_sale_list %}
         <tr>
            <td>{{sale.timestamp}}</td>
            <td>{{sale.product.name}}</td>
            <td class="price">{{sale.price|money}}</td>
         </tr>
      {% endfor %}
      {% endautoescape %}
   </table>

   <br />

   <p><b>I databasen ligger desuden f√∏lgende informationer om dig</b></p>
   <table class="default">
      <tr>
         <th>Felt</th>
         <th>V√¶rdi</th>
      </tr>
      <tr>
         <td>Bruger ID</td>
         <td>{{member.id}}</td>
      </tr>
      <tr>
         <td>Brugernavn</td>
         <td>{{member.username}}</td>
      </tr>
      <tr>
         <td>Fornavn(e)</td>
         <td>{{member.firstname}}</td>
      </tr>
      <tr>
         <td>Efternavn</td>
         <td>{{member.lastname}}</td>
      </tr>
      <tr>
         <td>Email adresse</td>
         <td>{{member.email}}</td>
      </tr>
      <tr>
         <td>√Örgang (indmeldelses√•r)</td>
         <td>{{member.year}}</td>
      </tr>
      <tr>
         <td>K√∏n</td>
         <td>{{member.gender}}</td>
      </tr>
      <tr>
         <td>Forbrug</td>
         <td>{{stats.total_amount|money}} ùìï$ / {{stats.total_purchases}} k√∏b</td>
      </tr>
   </table>
   <a href="/{{room.id}}/send_csv_mail/{{member.id}}/">Anmod om bruger data</a>

   <p><b>Achievements ({{ achievement_progress_str }}):</b></p>
   <div class="achievement-grid">
      {% for achievement in acquired_achievements %}
         <div class="achievement-card">
            <img 
               class="achievement-logo" 
               src="{% static 'stregsystem/achievement/' %}{{ achievement.achievement_task.achievement.icon_png }}" 
               alt="Achievement Logo">
            <div class="achievement-title">{{ achievement.achievement_task.achievement.title }}</div>
            <div class="achievement-description">{{ achievement.achievement_task.achievement.description }}</div>
         </div>
      {% endfor %}
      {% for achievement in missing_achievements %}
      <div class="achievement-card">
         <img 
            class="achievement-logo" 
            src="{% static 'stregsystem/achievement/achievement_missing.png' %}" 
            alt="Achievement Logo">
         <div class="achievement-title">{{ achievement.achievement_task.achievement.title }}</div>
      </div>
   {% endfor %}
   </div>
</main>

<style>
   .achievement-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      justify-content: center;
      margin-top: 10px;
   }
   
   .achievement-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 120px;
      text-align: center;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 8px;
      background-color: #f9f9f9;
   }
   
   .achievement-logo {
      width: 40px;
      height: 40px;
      object-fit: contain;
      margin-bottom: 8px;
   }
   
   .achievement-title {
      font-weight: bold;
      margin-bottom: 4px;
   }
   
   .achievement-description {
      font-size: 0.85em;
      color: #555;
   }
   
</style>


{% endblock %}